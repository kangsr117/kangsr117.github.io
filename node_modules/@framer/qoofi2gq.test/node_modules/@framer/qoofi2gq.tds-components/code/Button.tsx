import { addPropertyControls, ControlType } from 'framer';
import * as React from 'react';
import { useCallback, useState } from 'react';
import { Button as TDSButton, Props as TDSButtonProps } from '../@tossteam/tds-web/react/components/Button/Button';
import { TDSComponent } from '../src/components/TDSComponent';
import { useFilteringEventHandlersInInspector } from '../src/hooks/useFilteringEventHandlersInInspector';
import { useLoading } from '../src/hooks/useLoading';
import '../src/styles/tds-framer.css';
import { makeComponentDisplayName } from '../src/utils/makeDisplayName';

export const sizeLabels = ['Big', 'Large', 'Medium', 'Tiny'] as const;
export const styleLabels = ['Fill', 'Weak'] as const;
export const typeLabels = ['ğŸ”µ ë¸”ë£¨', 'âš«ï¸ ë‹¤í¬', 'ğŸ”´ ë ˆë“œ', 'âšªï¸ ë¼ì´íŠ¸'] as const;
export const disabledLabels = ['í™œì„±', 'ë¹„í™œì„±'] as const;
export const loadingLabels = ['ì—†ìŒ', '3ì´ˆ', 'ì˜ì›íˆ'] as const;
export const widthLabels = ['Auto', 'Fixed'] as const;

export type SizeLabel = typeof sizeLabels[number];
export type StyleLabel = typeof styleLabels[number];
export type TypeLabel = typeof typeLabels[number];
export type DisabledLabel = typeof disabledLabels[number];
export type LoadingLabel = typeof loadingLabels[number];
export type WidthLabel = typeof widthLabels[number];

const sizeByControlLabel: {
  [key in SizeLabel]: TDSButtonProps['size'];
} = {
  Big: 'big',
  Large: 'large',
  Medium: 'medium',
  Tiny: 'tiny',
};

export const typeByControlLabel: {
  [key in TypeLabel]: TDSButtonProps['type'];
} = {
  'ğŸ”µ ë¸”ë£¨': 'primary',
  'âš«ï¸ ë‹¤í¬': 'dark',
  'ğŸ”´ ë ˆë“œ': 'danger',
  'âšªï¸ ë¼ì´íŠ¸': 'light',
};

const disabledByControlLabel: {
  [key in DisabledLabel]: TDSButtonProps['disabled'];
} = {
  í™œì„±: false,
  ë¹„í™œì„±: true,
};

export const styleByControlLabel: {
  [key in StyleLabel]: TDSButtonProps['style'];
} = {
  Fill: 'fill',
  Weak: 'weak',
};

interface Props {
  text: string;
  size?: SizeLabel;
  style?: StyleLabel;
  type?: TypeLabel;
  disabled?: DisabledLabel;
  loading?: LoadingLabel;
  fixedWidth?: WidthLabel;

  disableInspector?: boolean;

  onClick?: () => void;
}

export function Button(props: Props) {
  const {
    text,
    style = 'Fill',
    type = 'ğŸ”µ ë¸”ë£¨',
    size = 'Big',
    disabled = 'í™œì„±',
    loading = 'ì—†ìŒ',
    fixedWidth = 'Auto',

    disableInspector,

    onClick,
  } = useFilteringEventHandlersInInspector(props);

  const [shouldLoading, setShouldLoading] = useState(false);
  const isLoadingEnabled = loading !== 'ì—†ìŒ';
  const useFullWidth = fixedWidth === 'Fixed';

  const handleClick = useCallback(() => {
    if (isLoadingEnabled) {
      setShouldLoading(true);
      return;
    }

    onClick?.();
  }, []);

  const handleLoadingFinish = useCallback(() => {
    onClick?.();
    setShouldLoading(false);
  }, [onClick]);

  const isLoading = useLoading({
    enabled: shouldLoading,
    duration: loading === '3ì´ˆ' ? 3000 : 0,
    onFinish: handleLoadingFinish,
  });

  return (
    <TDSComponent
      name="Button"
      summary={{
        size: sizeByControlLabel[size],
        style: styleByControlLabel[style],
        type: typeByControlLabel[type],
        disabled: disabledByControlLabel[disabled],
      }}
      disabled={disableInspector}
    >
      <TDSButton
        htmlStyle={
          useFullWidth
            ? {
                width: '100%',
              }
            : {}
        }
        size={sizeByControlLabel[size]}
        style={styleByControlLabel[style]}
        type={typeByControlLabel[type]}
        disabled={disabledByControlLabel[disabled]}
        loading={isLoading}
        onClick={handleClick}
      >
        {text}
      </TDSButton>
    </TDSComponent>
  );
}

addPropertyControls(Button, {
  text: {
    title: 'í…ìŠ¤íŠ¸',
    type: ControlType.String,
    defaultValue: 'ë²„íŠ¼',
  },
  size: {
    title: 'í¬ê¸°',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: sizeLabels as any,
    defaultValue: sizeLabels[0],
  },
  style: {
    title: 'íƒ€ì…',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: styleLabels as any,
    defaultValue: styleLabels[0],
  },
  type: {
    title: 'ìƒ‰ìƒ',
    type: ControlType.Enum,
    options: typeLabels as any,
    defaultValue: typeLabels[0],
  },
  fixedWidth: {
    title: 'ë²„íŠ¼ ê¸¸ì´',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: widthLabels as any,
    defaultValue: widthLabels[0],
  },
  disabled: {
    title: 'ìƒíƒœ',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: disabledLabels as any,
    defaultValue: disabledLabels[0],
  },
  loading: {
    title: 'ë¡œë”©',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: loadingLabels as any,
    defaultValue: loadingLabels[0],
  },
  onClick: {
    type: ControlType.EventHandler,
  },
});

(Button as any).defaultProps = {
  width: 96,
  height: 56,
};

Button.displayName = makeComponentDisplayName('Button', 'ë²„íŠ¼');
