import { addPropertyControls, ControlType } from 'framer';
import * as React from 'react';
import {
  PostH1 as TDSPostH1,
  PostH2 as TDSPostH2,
  PostH3 as TDSPostH3,
  PostH4 as TDSPostH4,
  PostLi as TDSPostLi,
  PostLink as TDSPostLink,
  PostOl as TDSPostOl,
  PostParagraph as TDSPostParagraph,
  PostUl as TDSPostUl,
} from '../@tossteam/tds-web/react/components/Post';
import { TDSComponent } from '../src/components/TDSComponent';
import '../src/styles/tds-framer.css';
import { makeComponentDisplayName } from '../src/utils/makeDisplayName';

const typeLabels = ['ì¼ë°˜ í…ìŠ¤íŠ¸', 'ë„˜ë²„, ë¶ˆë¦¿'] as const;
const textTypeLabels = [
  'ğŸ“ƒ ì‘ì€ ë³¸ë¬¸  ãƒ»  p small',
  'ğŸ“ƒ ì¼ë°˜ì ì¸ ë³¸ë¬¸  ãƒ»  p',
  'ğŸ”ˆ ì‘ì€ ì œëª©  ãƒ»  h4',
  'ğŸ”‰ ì¼ë°˜ì ì¸ ì œëª©  ãƒ»  h3',
  'ğŸ”Š í° ì œëª©  ãƒ»  h2',
  'ğŸ”Š ê°€ì¥ í° ì œëª©  ãƒ»  h1',
  'ğŸ”— ë§í¬  ãƒ»  Link',
] as const;
const bulletTypeLabels = [
  '1ï¸âƒ£ ì¼ë°˜ì ì¸ ë„˜ë²„ë§  ãƒ»  ol',
  '1ï¸âƒ£ ì‘ì€ ë„˜ë²„ë§  ãƒ»  ol small',
  'âº ì¼ë°˜ì ì¸ ë¶ˆë ›  ãƒ»  ul',
  'âº ì‘ì€ ë¶ˆë ›  ãƒ»  ul small',
] as const;
const indentationLabels = ['ì—†ìŒ', '1ë‹¨ê³„', '2ë‹¨ê³„'] as const;

type TypeLabel = typeof typeLabels[number];
type TextTypeLabel = typeof textTypeLabels[number];
type BulletTypeLabel = typeof bulletTypeLabels[number];
type IndentationLevelLabel = typeof indentationLabels[number];

const textComponentByControlLabel: Record<TextTypeLabel, JSX.Element> = {
  'ğŸ“ƒ ì‘ì€ ë³¸ë¬¸  ãƒ»  p small': <TDSPostParagraph small />,
  'ğŸ“ƒ ì¼ë°˜ì ì¸ ë³¸ë¬¸  ãƒ»  p': <TDSPostParagraph />,
  'ğŸ”ˆ ì‘ì€ ì œëª©  ãƒ»  h4': <TDSPostH4 />,
  'ğŸ”‰ ì¼ë°˜ì ì¸ ì œëª©  ãƒ»  h3': <TDSPostH3 />,
  'ğŸ”Š í° ì œëª©  ãƒ»  h2': <TDSPostH2 />,
  'ğŸ”Š ê°€ì¥ í° ì œëª©  ãƒ»  h1': <TDSPostH1 />,
  'ğŸ”— ë§í¬  ãƒ»  Link': <TDSPostLink href="" />,
};

const textComponentTypeNameByControlLabel: Record<TextTypeLabel, string> = {
  'ğŸ“ƒ ì‘ì€ ë³¸ë¬¸  ãƒ»  p small': 'paragraph small',
  'ğŸ“ƒ ì¼ë°˜ì ì¸ ë³¸ë¬¸  ãƒ»  p': 'paragraph',
  'ğŸ”ˆ ì‘ì€ ì œëª©  ãƒ»  h4': 'h4',
  'ğŸ”‰ ì¼ë°˜ì ì¸ ì œëª©  ãƒ»  h3': 'h3',
  'ğŸ”Š í° ì œëª©  ãƒ»  h2': 'h2',
  'ğŸ”Š ê°€ì¥ í° ì œëª©  ãƒ»  h1': 'h1',
  'ğŸ”— ë§í¬  ãƒ»  Link': 'link',
};

const bulletListComponentByControlLabel: Record<BulletTypeLabel, JSX.Element> = {
  '1ï¸âƒ£ ì¼ë°˜ì ì¸ ë„˜ë²„ë§  ãƒ»  ol': <TDSPostOl />,
  '1ï¸âƒ£ ì‘ì€ ë„˜ë²„ë§  ãƒ»  ol small': <TDSPostOl small />,
  'âº ì¼ë°˜ì ì¸ ë¶ˆë ›  ãƒ»  ul': <TDSPostUl />,
  'âº ì‘ì€ ë¶ˆë ›  ãƒ»  ul small': <TDSPostUl small />,
};

const bulletListComponentTypeNameByControlLabel: Record<BulletTypeLabel, string> = {
  '1ï¸âƒ£ ì¼ë°˜ì ì¸ ë„˜ë²„ë§  ãƒ»  ol': 'ol',
  '1ï¸âƒ£ ì‘ì€ ë„˜ë²„ë§  ãƒ»  ol small': 'ol small',
  'âº ì¼ë°˜ì ì¸ ë¶ˆë ›  ãƒ»  ul': 'ul',
  'âº ì‘ì€ ë¶ˆë ›  ãƒ»  ul small': 'ul small',
};

const indentationPaddingByControlLabel: Record<IndentationLevelLabel, string> = {
  ì—†ìŒ: '0',
  '1ë‹¨ê³„': '24px',
  '2ë‹¨ê³„': '48px',
};

interface Props {
  text: string;
  type: TypeLabel;
  textType: TextTypeLabel;
  bulletType: BulletTypeLabel;
  bulletStartIndex: number;
  indentationLevel: IndentationLevelLabel;
}

function getTextComponent({ text, textType }: Pick<Props, 'text' | 'textType'>) {
  return React.cloneElement(
    textComponentByControlLabel[textType],
    { style: { whiteSpace: 'pre-wrap' } },
    text.split('\n').map((textToken, index, array) => (
      <React.Fragment key={index}>
        <span>{textToken}</span>
        {index < array.length - 1 && <br />}
      </React.Fragment>
    ))
  );
}

function getBulletListComponent({
  text,
  bulletType,
  bulletStartIndex,
  indentationLevel,
}: Pick<Props, 'text' | 'bulletType' | 'bulletStartIndex' | 'indentationLevel'>) {
  return React.cloneElement(
    bulletListComponentByControlLabel[bulletType],
    {
      style: {
        counterReset: `post-list ${bulletStartIndex - 1}`,
        paddingBottom: 8,
        marginLeft: indentationPaddingByControlLabel[indentationLevel],
      },
    },
    text.split('\n').map((token, index) => <TDSPostLi key={index}>{token ? token : ' '}</TDSPostLi>)
  );
}

export function Post(props: Props) {
  return (
    <TDSComponent
      name="Post"
      summary={{
        type:
          props.type === 'ì¼ë°˜ í…ìŠ¤íŠ¸'
            ? textComponentTypeNameByControlLabel[props.textType]
            : bulletListComponentTypeNameByControlLabel[props.bulletType],
        text: props.text,
        indentation:
          props.indentationLevel !== 'ì—†ìŒ' ? indentationPaddingByControlLabel[props.indentationLevel] : undefined,
      }}
    >
      {props.type === 'ì¼ë°˜ í…ìŠ¤íŠ¸' ? getTextComponent(props) : getBulletListComponent(props)}
    </TDSComponent>
  );
}

addPropertyControls(Post, {
  type: {
    title: 'ì¢…ë¥˜',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: typeLabels as any,
    defaultValue: typeLabels[0],
  },
  textType: {
    title: 'â†³ ìœ í˜•',
    type: ControlType.Enum,
    options: textTypeLabels as any,
    defaultValue: textTypeLabels[4],
    hidden(props) {
      return props.type !== 'ì¼ë°˜ í…ìŠ¤íŠ¸';
    },
  },
  bulletType: {
    title: 'â†³ ìœ í˜•',
    type: ControlType.Enum,
    options: bulletTypeLabels as any,
    defaultValue: bulletTypeLabels[0],
    hidden(props) {
      return props.type !== 'ë„˜ë²„, ë¶ˆë¦¿';
    },
  },
  text: {
    title: 'â†³ í…ìŠ¤íŠ¸',
    type: ControlType.String,
    displayTextArea: true,
    defaultValue: 'ë™í•´ë¬¼ê³¼\në°±ë‘ì‚°ì´\në§ˆë¥´ê³  ë‹³ë„ë¡',
  },
  bulletStartIndex: {
    title: 'ì‹œì‘ ìˆ«ì',
    type: ControlType.Number,
    displayStepper: true,
    min: 1,
    max: 15,
    defaultValue: 1,
    hidden(props) {
      return (
        props.type !== 'ë„˜ë²„, ë¶ˆë¦¿' ||
        !(props.bulletType === '1ï¸âƒ£ ì¼ë°˜ì ì¸ ë„˜ë²„ë§  ãƒ»  ol' || props.bulletType === '1ï¸âƒ£ ì‘ì€ ë„˜ë²„ë§  ãƒ»  ol small')
      );
    },
  },
  indentationLevel: {
    title: 'ë“¤ì—¬ì“°ê¸°',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: indentationLabels as any,
    defaultValue: indentationLabels[0],
    hidden(props) {
      return props.type !== 'ë„˜ë²„, ë¶ˆë¦¿';
    },
  },
});

(Post as any).defaultProps = {
  width: 375,
  height: 133,
};

Post.displayName = makeComponentDisplayName('Post', 'í¬ìŠ¤íŠ¸');
