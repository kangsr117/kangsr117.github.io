import { addPropertyControls, ControlType, PropertyControls } from 'framer';
import * as React from 'react';
import { default as TDSForm } from '../@tossteam/tds-web/react/components/Form/Form';
import {
  default as TDSTextFieldLine,
  Props as TDSTextFieldLineProps,
} from '../@tossteam/tds-web/react/components/TextFieldLine/TextFieldLine';
import { TDSComponent } from '../src/components/TDSComponent';
import { useFilteringEventHandlersInInspector } from '../src/hooks/useFilteringEventHandlersInInspector';
import '../src/styles/tds-framer.css';
import { isStaticRenderTarget } from '../src/utils/isStaticRenderTarget';
import { makeComponentDisplayName } from '../src/utils/makeDisplayName';

const typeLabels = [
  'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸',
  'ğŸ˜€ ì´ë¦„',
  'ğŸ’° ê¸ˆì•¡',
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬',
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ë’¤ 7ìë¦¬',
  'ğŸ“± ì „í™”ë²ˆí˜¸',
  'ğŸ” ë¹„ë°€ë²ˆí˜¸',
  '0ï¸âƒ£ ìˆ«ì',
] as const;
const stateLabels = ['ì¼ë°˜', 'ğŸš§í™œì„±', 'ì—ëŸ¬', 'ë¹„í™œì„±'] as const;
const keyboardTypeLabels = ['í•œê¸€', 'ì˜ë¬¸', 'ìˆ«ì'] as const;
const withClearButtonLabels = ['ON', 'OFF'] as const;
const withPasswordPreviewButtonLabels = ['ON', 'OFF'] as const;
const autoFocusLabels = ['ON', 'OFF'] as const;

type TypeLabel = typeof typeLabels[number];
type StateLabel = typeof stateLabels[number];
type KeyboardTypeLabel = typeof keyboardTypeLabels[number];
type WithClearButtonLabel = typeof withClearButtonLabels[number];
type WithPasswordPreviewButtonLabel = typeof withPasswordPreviewButtonLabels[number];
type AutoFocusLabel = typeof autoFocusLabels[number];

const defaultValueByType: {
  [key in TypeLabel]: { key: string; label: string };
} = {
  'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸': {
    key: 'plainText',
    label: 'ë ˆì´ë¸”',
  },
  'ğŸ˜€ ì´ë¦„': {
    key: 'name',
    label: 'ì´ë¦„ ì…ë ¥',
  },
  'ğŸ’° ê¸ˆì•¡': {
    key: 'price',
    label: 'ê¸ˆì•¡ ì…ë ¥',
  },
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬': {
    key: 'nationalIDFirst',
    label: 'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸',
  },
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ë’¤ 7ìë¦¬': {
    key: 'nationalIDLast',
    label: 'ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸',
  },
  'ğŸ“± ì „í™”ë²ˆí˜¸': {
    key: 'phone',
    label: 'íœ´ëŒ€í°ë²ˆí˜¸',
  },
  'ğŸ” ë¹„ë°€ë²ˆí˜¸': {
    key: 'password',
    label: 'ë¹„ë°€ë²ˆí˜¸',
  },
  '0ï¸âƒ£ ìˆ«ì': {
    key: 'number',
    label: 'ì œëª©',
  },
};

const propertyControls = Object.entries(defaultValueByType).reduce<PropertyControls<Props, any>>(
  (acc, [type, defaultValue]) => ({
    ...acc,
    [`${defaultValue.key}Label`]: {
      title: 'ì œëª©',
      type: ControlType.String,
      defaultValue: defaultValue.label,
      hidden(props) {
        return props.type !== type;
      },
    },
  }),
  {}
);

const propsByTypeControlLabel: {
  [key in TypeLabel]: Partial<TDSTextFieldLineProps>;
} = {
  'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸': { type: 'text' },
  'ğŸ˜€ ì´ë¦„': { type: 'name' },
  'ğŸ’° ê¸ˆì•¡': { type: 'tel' },
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬': { type: 'tel' },
  'ğŸš§ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ë’¤ 7ìë¦¬': { type: 'numberPassword' },
  'ğŸ“± ì „í™”ë²ˆí˜¸': { type: 'tel' },
  'ğŸ” ë¹„ë°€ë²ˆí˜¸': { type: 'numberPassword' },
  '0ï¸âƒ£ ìˆ«ì': { type: 'tel' },
};

const autoFocusByControlLabel: {
  [key in AutoFocusLabel]: TDSTextFieldLineProps['autoFocus'];
} = {
  ON: true,
  OFF: false,
};

interface Props {
  type: TypeLabel;
  inputValue: string;
  helpText: string;
  subText: string;
  suffix: string;
  state: StateLabel;
  keyboardType: KeyboardTypeLabel;
  withClearButton: WithClearButtonLabel;
  withPasswordPreviewButton: WithPasswordPreviewButtonLabel;
  autoFocus: AutoFocusLabel;

  onFocus: () => void;
  onChange: () => void;
  onSubmit: () => void;
}

export function TextFieldLine(props: Props) {
  const {
    type,
    inputValue,
    helpText,
    subText,
    suffix,
    state,
    keyboardType,
    withClearButton,
    withPasswordPreviewButton,
    autoFocus,

    onFocus,
    onChange,
    onSubmit,
    ...rest
  } = useFilteringEventHandlersInInspector(props);

  const [value, setValue] = React.useState(inputValue);

  React.useEffect(() => {
    setValue(inputValue);
  }, [inputValue]);

  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    setValue(event.target.value);
    onChange?.();
  };

  return (
    <TDSForm>
      <TDSForm.Group help={helpText} hasError={state === 'ì—ëŸ¬'}>
        <TDSComponent
          name="TextFieldLine"
          summary={{
            value: value ? value : undefined,
            label: rest[`${defaultValueByType[type].key}Label`],
            suffix: type === 'ğŸ’° ê¸ˆì•¡' ? suffix : undefined,
            subText: subText ? subText : undefined,
            autoFocus: autoFocusByControlLabel[autoFocus],
            error: state === 'ì—ëŸ¬',
            disabled: state === 'ë¹„í™œì„±',
          }}
        >
          <TDSTextFieldLine
            {...propsByTypeControlLabel[type]}
            label={rest[`${defaultValueByType[type].key}Label`]}
            value={value}
            suffix={type === 'ğŸ’° ê¸ˆì•¡' ? suffix : undefined}
            subText={subText}
            autoFocus={isStaticRenderTarget() ? false : autoFocusByControlLabel[autoFocus]}
            hasError={state === 'ì—ëŸ¬'}
            disabled={state === 'ë¹„í™œì„±'}
            onChange={handleChange}
            onFocus={onFocus}
            onKeyPress={e => {
              if (e.which === 13) {
                onSubmit();
              }
            }}
          />
        </TDSComponent>
      </TDSForm.Group>
    </TDSForm>
  );
}

addPropertyControls(TextFieldLine, {
  type: {
    title: 'ì¢…ë¥˜',
    type: ControlType.Enum,
    options: typeLabels as any,
    defaultValue: 'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸',
  },
  ...propertyControls,
  inputValue: {
    title: 'ì…ë ¥ê°’',
    type: ControlType.String,
    defaultValue: '',
  },
  helpText: {
    title: 'ë„ì›€ë§',
    type: ControlType.String,
    defaultValue: '',
  },
  subText: {
    title: 'ì„œë¸Œí…ìŠ¤íŠ¸',
    type: ControlType.String,
    defaultValue: '',
  },
  suffix: {
    title: 'ì› í‘œì‹œ',
    type: ControlType.String,
    defaultValue: 'ì›',
    hidden(props) {
      return props.type !== 'ğŸ’° ê¸ˆì•¡';
    },
  },
  state: {
    title: 'ìƒíƒœ',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: stateLabels as any,
    defaultValue: 'ì¼ë°˜',
  },
  withClearButton: {
    title: 'ğŸš§ì§€ìš°ê¸°ë²„íŠ¼',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: withClearButtonLabels as any,
    defaultValue: 'ON',
    hidden(props) {
      return [
        'ğŸ’° ê¸ˆì•¡',
        'ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬',
        'ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ë’¤ 7ìë¦¬',
        'ğŸ“± ì „í™”ë²ˆí˜¸',
        'ğŸ” ë¹„ë°€ë²ˆí˜¸',
        '0ï¸âƒ£ ìˆ«ì',
      ].includes(props.type);
    },
  },
  withPasswordPreviewButton: {
    title: 'ğŸš§ë¹„ë²ˆ ë³´ê¸° ë²„íŠ¼',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: withClearButtonLabels as any,
    defaultValue: 'ON',
    hidden(props) {
      return props.type !== 'ğŸ” ë¹„ë°€ë²ˆí˜¸';
    },
  },
  autoFocus: {
    title: 'ìë™ í¬ì»¤ìŠ¤',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: autoFocusLabels as any,
    defaultValue: 'OFF',
  },

  onFocus: {
    type: ControlType.EventHandler,
  },
  onChange: {
    type: ControlType.EventHandler,
  },
  onSubmit: {
    type: ControlType.EventHandler,
  },
});

(TextFieldLine as any).defaultProps = {
  width: 375,
  height: 55,
};

TextFieldLine.displayName = makeComponentDisplayName('TextFieldMedium', 'í…ìŠ¤íŠ¸í•„ë“œ');
