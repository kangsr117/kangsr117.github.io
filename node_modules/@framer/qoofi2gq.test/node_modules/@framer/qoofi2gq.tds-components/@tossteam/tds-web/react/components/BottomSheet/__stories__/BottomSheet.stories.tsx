import { action } from "@storybook/addon-actions";
import { boolean } from "@storybook/addon-knobs";
import { storiesOf } from "@storybook/react";
import * as React from "react";
import { useEffect, useState } from "react";
import { useBottomSheet } from "src/react";
import DummyList from "../../../storybook/DummyList";
import FixedBottomCTA from "../../FixedBottomCTA";
import BottomSheet from "../BottomSheet";
import Readme from "../README.md";

storiesOf("BottomSheet", module)
  .addParameters({
    readme: {
      sidebar: Readme,
    },
  })
  .add("Showcase", () => {
    const [isOpened, setIsOpened] = useState(false);

    return (
      <>
        <FixedBottomCTA onClick={() => setIsOpened(true)}>
          바텀 시트 열기
        </FixedBottomCTA>
        <BottomSheet
          open={isOpened}
          header={
            <>
              <BottomSheet.Header>
                타이틀이 길어질 때
                <br />
                두줄이 될수도 있습니다
              </BottomSheet.Header>
              <BottomSheet.HeaderDescription>
                동해물과 백두산이 마르고 닳도록 하느님이
                <br />
                보우하사 우리나라 만세
              </BottomSheet.HeaderDescription>
            </>
          }
          onClose={() => setIsOpened(false)}
          onEntered={action("onEntered")}
          onExited={action("onExited")}
          fromTop={boolean("FromTop", false)}
        >
          <DummyList />
        </BottomSheet>
      </>
    );
  })
  .add("Basic", () => {
    return (
      <BottomSheet open={boolean("Open", true)} header="바텀 시트 헤더">
        <DummyList />
      </BottomSheet>
    );
  })
  .add('useBottomSheet "closeOnDestroy" 옵션', () => {
    const open = boolean("컴포넌트 마운트/언마운트", false);
    const closeOnDestroy = boolean('"closeOnDestroy" 옵션', true);

    return (
      <>
        Knobs 참조
        {open ? <CloseOnDestroy closeOnDestroy={closeOnDestroy} /> : null}
      </>
    );
  });

function CloseOnDestroy({ closeOnDestroy }: { closeOnDestroy: boolean }) {
  const { openOneButtonSheet } = useBottomSheet({ closeOnDestroy });

  useEffect(() => {
    openOneButtonSheet({
      header: "옥수수 수염차",
      button: "맛있어요",
    });
  }, [openOneButtonSheet]);

  return <></>;
}
