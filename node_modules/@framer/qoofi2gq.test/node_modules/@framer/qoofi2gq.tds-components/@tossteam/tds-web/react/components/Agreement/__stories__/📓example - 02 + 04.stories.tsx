import { action } from '@storybook/addon-actions';
import { storiesOf } from '@storybook/react';
import _ from 'lodash';
import * as React from 'react';

import { Agreement, FixedBottomCTA } from 'src/react';

import Readme from '../README.md';

storiesOf('Agreement', module)
  .addParameters({ readme: { sidebar: Readme } })
  .add('📓example - 02 + 04', () => {
    function AgreementRow02And04Example() {
      const [checkedList, setChecked] = React.useState(_.times(4, () => false));

      function onChangeAllChecked(event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        setChecked(_.times(4, () => checked));
        action('onChange - Agreement02 - 토스 필수 항목 모두 동의')(event);
      }

      function onChangeChecked(index: number, event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        const nextCheckedList = checkedList.slice();
        nextCheckedList.splice(index, 1, checked);
        setChecked(nextCheckedList);
        action(`onChange - Agreement03 필수 항목 ${index + 1} 동의`)(event);
      }

      function onClickStartButton() {
        if (_.every(checkedList)) {
          alert(`성공!`);
        } else {
          alert('필수 약관에 동의해주세요.');
        }
      }

      return (
        <>
          <Agreement.Section>
            <Agreement.List>
              <Agreement.Row02 checked={_.every(checkedList)} onChange={onChangeAllChecked}>
                토스 필수 항목 모두 동의
              </Agreement.Row02>
              {checkedList.map((checked, index) => (
                <Agreement.Row04
                  checked={checked}
                  onChange={_.partial(onChangeChecked, index)}
                  onLabelClick={action(
                    `onLabelClick - AgreementRow04 - 필수 항목 ${index + 1} 동의`
                  )}
                  key={`agreement-${index}`}
                >
                  필수 항목 {index + 1} 동의
                </Agreement.Row04>
              ))}
            </Agreement.List>
          </Agreement.Section>
          <FixedBottomCTA onClick={onClickStartButton}>시작</FixedBottomCTA>
        </>
      );
    }

    return <AgreementRow02And04Example />;
  });
