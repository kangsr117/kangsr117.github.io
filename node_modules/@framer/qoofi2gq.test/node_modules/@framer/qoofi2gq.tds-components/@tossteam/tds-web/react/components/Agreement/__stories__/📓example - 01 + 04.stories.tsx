import { action } from "@storybook/addon-actions";
import { storiesOf } from "@storybook/react";
import _ from "lodash";
import * as React from "react";
import { useState } from "react";
import { Agreement, FixedBottomCTA, TextButton } from "src/react";
import Readme from "../README.md";

storiesOf("Agreement", module)
  .addParameters({ readme: { sidebar: Readme } })
  .add("ğŸ““example - 01 + 04", () => {
    const items = [
      "ì¢…í•© ê³„ì¢Œ ì•½ê´€",
      "ëª¨ë°”ì¼ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€",
      "ë§¤ë§¤ê±°ë˜ê³„ì¢Œ ì„¤ì •ì•½ê´€",
      "ì¼ì¦ë§¤ë§¤ê±°ë˜ ìœ„í—˜ë™ì˜",
      "ì „ì ê¸ˆìœµ ê±°ë˜ ì´ìš©ì•½ê´€",
      "ê°œì¸ì‹ ìš©ì •ë³´ ì œê³µ ë™ì˜",
    ];

    function AgreementDetails() {
      return (
        <ul style={{ margin: "8px 0", padding: 0 }}>
          {items.map((item) => (
            <li
              key={item}
              style={{ listStyle: "none", margin: 0, padding: "0 0 0 70px" }}
            >
              <TextButton type="underline">{item}</TextButton>
            </li>
          ))}
        </ul>
      );
    }

    function AgreementRow01And04Example() {
      const [detailsOpened, setDetailsOpened] = useState(true);
      const [checkedList, setChecked] = React.useState(_.times(4, () => false));

      function onChangeAllChecked(event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        setChecked(_.times(4, () => checked));
        action("onChange - Agreement01 - ì•½ê´€ì— ëª¨ë‘ ë™ì˜")(event);
      }

      function onChangeChecked(
        index: number,
        event: React.ChangeEvent<HTMLInputElement>
      ) {
        const { checked } = event.target;
        if (index === 0 && checked) {
          setDetailsOpened(false);
        }

        const nextCheckedList = checkedList.slice();
        nextCheckedList.splice(index, 1, checked);
        setChecked(nextCheckedList);
        action(`onChange - Agreement03 í•„ìˆ˜ í•­ëª© ${index + 1} ë™ì˜`)(event);
      }

      function onClickStartButton() {
        if (_.every(checkedList)) {
          alert(`ì„±ê³µ!`);
        } else {
          alert("í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.");
        }
      }

      return (
        <>
          <Agreement.Section>
            <Agreement.Row01
              checked={_.every(checkedList)}
              onChange={onChangeAllChecked}
              right={
                <Agreement.RightArrow
                  onClick={action("onClick - ArrowRow01 label")}
                />
              }
            >
              ì•½ê´€ì— ëª¨ë‘ ë™ì˜
            </Agreement.Row01>

            <Agreement.List>
              <Agreement.Row04
                checked={checkedList[0]}
                onChange={_.partial(onChangeChecked, 0)}
                onLabelClick={action(
                  `onLabelClick - AgreementRow04 - í•„ìˆ˜ í•­ëª© 1 ë™ì˜`
                )}
                right={
                  <Agreement.RightArrow
                    iconName={
                      detailsOpened ? "arrow-downwards" : "arrow-rightwards"
                    }
                    onClick={() => setDetailsOpened((opened) => !opened)}
                  />
                }
                rightFixed={true}
              >
                í•„ìˆ˜ í•­ëª© 1 ë™ì˜
              </Agreement.Row04>

              {detailsOpened ? <AgreementDetails /> : null}

              {checkedList.slice(1).map((checked, index, arr) => (
                <Agreement.Row04
                  checked={checked}
                  onChange={_.partial(onChangeChecked, index + 1)}
                  onLabelClick={action(
                    `onLabelClick - AgreementRow04 - í•„ìˆ˜ í•­ëª© ${
                      index + 2
                    } ë™ì˜`
                  )}
                  key={`agreement-${index}`}
                  right={index === arr.length - 1 ? null : undefined}
                  rightFixed={true}
                >
                  í•„ìˆ˜ í•­ëª© {index + 2} ë™ì˜
                </Agreement.Row04>
              ))}
            </Agreement.List>
          </Agreement.Section>
          <FixedBottomCTA onClick={onClickStartButton}>ì‹œì‘</FixedBottomCTA>
        </>
      );
    }

    return <AgreementRow01And04Example />;
  });
