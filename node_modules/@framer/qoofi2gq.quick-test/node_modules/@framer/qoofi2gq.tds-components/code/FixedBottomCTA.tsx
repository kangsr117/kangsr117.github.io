import { addPropertyControls, ControlType } from 'framer';
import * as React from 'react';
import { default as TDSBottomCTA } from '../@tossteam/tds-web/react/components/BottomCTA';
import { Props as TDSButtonProps } from '../@tossteam/tds-web/react/components/Button/Button';
import { TextButton as TDSTextButton } from '../@tossteam/tds-web/react/components/TextButton/TextButton';
import convertNewLineToJSX from '../@tossteam/tds-web/react/utils/convertNewLineToJSX';
import { IPhoneSafeAreaContainer } from '../src/components/iPhoneSafeAreaContainer';
import { TDSComponent } from '../src/components/TDSComponent';
import { useFilteringEventHandlersInInspector } from '../src/hooks/useFilteringEventHandlersInInspector';
import '../src/styles/tds-framer.css';
import { makeComponentDisplayName } from '../src/utils/makeDisplayName';
import { Button } from './Button';

const typeLabels = ['1ê°œ', '2ê°œ'] as const;
const buttonStyleLabels = ['Fill', 'Weak'] as const;
const buttonTypeLabels = ['ğŸ”µ ë¸”ë£¨', 'âš«ï¸ ë‹¤í¬', 'ğŸ”´ ë ˆë“œ', 'âšªï¸ ë¼ì´íŠ¸'] as const;
const buttonDisabledLabels = ['í™œì„±', 'ë¹„í™œì„±'] as const;
const safeAreaPaddingLabels = ['ON', 'OFF'] as const;
const showAdditionalOptionsLabels = ['ON', 'OFF'] as const;
const showDescriptionLabels = ['ìˆìŒ', 'ì—†ìŒ'] as const;
const descriptionPositionLabels = ['ìœ„', 'ì•„ë˜'] as const;
const showTopButtonLabels = ['ìˆìŒ', 'ì—†ìŒ'] as const;

type TypeLabel = typeof typeLabels[number];
type ButtonStyleLabel = typeof buttonStyleLabels[number];
type ButtonTypeLabel = typeof buttonTypeLabels[number];
type ButtonDisabledLabel = typeof buttonDisabledLabels[number];
type SafeAreaPaddingLabel = typeof safeAreaPaddingLabels[number];
type ShowAdditionalOptionsLabel = typeof showAdditionalOptionsLabels[number];
type ShowDescriptionLabel = typeof showDescriptionLabels[number];
type DescriptionPositionLabel = typeof descriptionPositionLabels[number];
type ShowTopButtonLabel = typeof showTopButtonLabels[number];

const buttonTypeByControlLabel: {
  [key in ButtonTypeLabel]: TDSButtonProps['type'];
} = {
  'ğŸ”µ ë¸”ë£¨': 'primary',
  'âš«ï¸ ë‹¤í¬': 'dark',
  'ğŸ”´ ë ˆë“œ': 'danger',
  'âšªï¸ ë¼ì´íŠ¸': 'light',
};

const buttonDisabledByControlLabel: {
  [key in ButtonDisabledLabel]: TDSButtonProps['disabled'];
} = {
  í™œì„±: false,
  ë¹„í™œì„±: true,
};

const buttonStyleByControlLabel: {
  [key in ButtonStyleLabel]: TDSButtonProps['style'];
} = {
  Fill: 'fill',
  Weak: 'weak',
};

const safeAreaPaddingByControlLabels: {
  [key in SafeAreaPaddingLabel]: boolean;
} = {
  ON: true,
  OFF: false,
};

interface Props {
  type: TypeLabel;
  buttonTitle: string;
  primaryButtonTitle: string;
  primaryButtonStyle: ButtonStyleLabel;
  primaryButtonType: ButtonTypeLabel;
  primaryButtonDisabled: ButtonDisabledLabel;
  secondaryButtonTitle: string;
  secondaryButtonStyle: ButtonStyleLabel;
  secondaryButtonType: ButtonTypeLabel;
  secondaryButtonDisabled: ButtonDisabledLabel;
  safeAreaPadding: SafeAreaPaddingLabel;
  showAdditionalOptions: ShowAdditionalOptionsLabel;
  showDescription: ShowDescriptionLabel;
  descriptionPosition: DescriptionPositionLabel;
  descriptionText: string;
  showTopButton: ShowTopButtonLabel;
  topButtonText: string;

  onButtonClick?: () => void;
  onRightButtonClick?: () => void;
  onLeftButtonClick?: () => void;
  onTopButtonClick?: () => void;
}

export function FixedBottomCTA(props: Props) {
  const {
    type,
    buttonTitle,
    primaryButtonTitle,
    primaryButtonStyle,
    primaryButtonType,
    primaryButtonDisabled,
    secondaryButtonTitle,
    secondaryButtonStyle,
    secondaryButtonType,
    secondaryButtonDisabled,
    safeAreaPadding,
    showDescription,
    descriptionPosition,
    descriptionText,
    showTopButton,
    topButtonText,
    onButtonClick,
    onRightButtonClick,
    onLeftButtonClick,
    onTopButtonClick,
  } = useFilteringEventHandlersInInspector(props);

  const shouldRenderTopDescription = showDescription === 'ìˆìŒ' && descriptionPosition === 'ìœ„';
  const shouldRenderTopButton = showTopButton === 'ìˆìŒ';
  const topAccessory =
    shouldRenderTopDescription || shouldRenderTopButton ? (
      <div
        style={{
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
        }}
      >
        {shouldRenderTopDescription && convertNewLineToJSX(descriptionText)}
        {shouldRenderTopButton && (
          <TDSTextButton type="primary" style={{ textAlign: 'center' }} onClick={onTopButtonClick}>
            {topButtonText}
          </TDSTextButton>
        )}
      </div>
    ) : undefined;

  const shouldRenderBottomDescription = showDescription === 'ìˆìŒ' && descriptionPosition === 'ì•„ë˜';
  const bottomAccessory = shouldRenderBottomDescription ? convertNewLineToJSX(descriptionText) : undefined;

  const component =
    type === '1ê°œ' ? (
      <TDSBottomCTA.TypeA
        type={buttonTypeByControlLabel[primaryButtonType]}
        style={buttonStyleByControlLabel[primaryButtonStyle]}
        disabled={buttonDisabledByControlLabel[primaryButtonDisabled]}
        hasSafeAreaPadding={safeAreaPaddingByControlLabels[safeAreaPadding]}
        topAccessory={topAccessory}
        bottomAccessory={bottomAccessory}
        onClick={onButtonClick}
      >
        {buttonTitle}
      </TDSBottomCTA.TypeA>
    ) : (
      <TDSBottomCTA.TypeB
        rightButton={
          <Button
            text={primaryButtonTitle}
            size="Big"
            type={primaryButtonType}
            style={primaryButtonStyle}
            disabled={primaryButtonDisabled}
            onClick={onRightButtonClick}
            disableInspector
          />
        }
        leftButton={
          <Button
            text={secondaryButtonTitle}
            size="Big"
            type={secondaryButtonType}
            style={secondaryButtonStyle}
            disabled={secondaryButtonDisabled}
            onClick={onLeftButtonClick}
            disableInspector
          />
        }
        hasSafeAreaPadding={safeAreaPaddingByControlLabels[safeAreaPadding]}
        topAccessory={topAccessory}
        bottomAccessory={bottomAccessory}
      />
    );

  return (
    <IPhoneSafeAreaContainer iPhoneX={safeAreaPadding === 'ON'} safeAreaHeight={16} safeAreaBackgroundColor="white">
      <TDSComponent
        name={`FixedBottomCTA`}
        summary={{
          button:
            type === '1ê°œ'
              ? {
                  type: buttonTypeByControlLabel[primaryButtonType],
                  style: buttonStyleByControlLabel[primaryButtonStyle],
                  size: 'big',
                  disabled: buttonDisabledByControlLabel[primaryButtonDisabled],
                  text: buttonTitle,
                }
              : undefined,
          leftButton:
            type === '2ê°œ'
              ? {
                  type: buttonTypeByControlLabel[secondaryButtonType],
                  style: buttonStyleByControlLabel[secondaryButtonStyle],
                  size: 'big',
                  disabled: buttonDisabledByControlLabel[secondaryButtonDisabled],
                  text: secondaryButtonTitle,
                }
              : undefined,
          rightButton:
            type === '2ê°œ'
              ? {
                  type: buttonTypeByControlLabel[primaryButtonType],
                  style: buttonStyleByControlLabel[primaryButtonStyle],
                  size: 'big',
                  disabled: buttonDisabledByControlLabel[primaryButtonDisabled],
                  text: primaryButtonTitle,
                }
              : undefined,
          topButton: shouldRenderTopButton ? topButtonText : undefined,
          topDescription: shouldRenderTopDescription ? descriptionText : undefined,
          bottomDescription: shouldRenderBottomDescription ? descriptionText : undefined,
        }}
      >
        {component}
      </TDSComponent>
    </IPhoneSafeAreaContainer>
  );
}

addPropertyControls(FixedBottomCTA, {
  type: {
    title: 'ë²„íŠ¼ ê°œìˆ˜',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: typeLabels as any,
    defaultValue: '1ê°œ',
  },
  buttonTitle: {
    title: 'ë²„íŠ¼',
    type: ControlType.String,
    defaultValue: 'ë²„íŠ¼ë ˆì´ë¸”',
    hidden(props) {
      return props.type !== '1ê°œ';
    },
  },
  primaryButtonTitle: {
    title: 'ğŸ‘‰ ì˜¤ë¥¸ìª½ ë²„íŠ¼',
    type: ControlType.String,
    defaultValue: 'ë²„íŠ¼ë ˆì´ë¸”',
    hidden(props) {
      return props.type !== '2ê°œ';
    },
  },
  primaryButtonStyle: {
    title: 'â†³ íƒ€ì…',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: buttonStyleLabels as any,
    defaultValue: 'Fill',
  },
  primaryButtonType: {
    title: 'â†³ ìƒ‰ìƒ',
    type: ControlType.Enum,
    options: ['ğŸ”µ ë¸”ë£¨', 'âš«ï¸ ë‹¤í¬', 'ğŸ”´ ë ˆë“œ', 'âšªï¸ ë¼ì´íŠ¸'],
    defaultValue: 'ğŸ”µ ë¸”ë£¨',
  },
  primaryButtonDisabled: {
    title: 'â†³ ìƒíƒœ',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: buttonDisabledLabels as any,
    defaultValue: 'í™œì„±',
  },
  secondaryButtonTitle: {
    title: 'ğŸ‘ˆ ì™¼ìª½ ë²„íŠ¼',
    type: ControlType.String,
    defaultValue: 'ë²„íŠ¼ë ˆì´ë¸”',
    hidden(props) {
      return props.type !== '2ê°œ';
    },
  },
  secondaryButtonStyle: {
    title: 'â†³ íƒ€ì…',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: buttonStyleLabels as any,
    defaultValue: 'Weak',
    hidden(props) {
      return props.type !== '2ê°œ';
    },
  },
  secondaryButtonType: {
    title: 'â†³ ìƒ‰ìƒ',
    type: ControlType.Enum,
    options: ['ğŸ”µ ë¸”ë£¨', 'âš«ï¸ ë‹¤í¬', 'ğŸ”´ ë ˆë“œ', 'âšªï¸ ë¼ì´íŠ¸'],
    defaultValue: 'ğŸ”µ ë¸”ë£¨',
    hidden(props) {
      return props.type !== '2ê°œ';
    },
  },
  secondaryButtonDisabled: {
    title: 'â†³ ìƒíƒœ',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: buttonDisabledLabels as any,
    defaultValue: 'í™œì„±',
    hidden(props) {
      return props.type !== '2ê°œ';
    },
  },
  safeAreaPadding: {
    title: 'ì•„ì´í° X',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: safeAreaPaddingLabels as any,
    defaultValue: 'OFF',
  },
  showAdditionalOptions: {
    title: 'ì˜µì…˜ ë”ë³´ê¸° âš™ï¸',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: showAdditionalOptionsLabels as any,
    defaultValue: 'OFF',
  },
  showDescription: {
    title: 'ì„¤ëª… ì˜µì…˜',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: showDescriptionLabels as any,
    defaultValue: 'ì—†ìŒ',
    hidden(props) {
      return props.showAdditionalOptions === 'OFF';
    },
  },
  descriptionPosition: {
    title: 'â†³ ìœ„ì¹˜',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: descriptionPositionLabels as any,
    defaultValue: 'ì•„ë˜',
    hidden(props) {
      return props.showAdditionalOptions === 'OFF' || props.showDescription !== 'ìˆìŒ';
    },
  },
  descriptionText: {
    title: 'â†³ í…ìŠ¤íŠ¸',
    type: ControlType.String,
    defaultValue: 'ì„¤ëª…ì„ ì ì„ ë•Œ',
    displayTextArea: true,
    hidden(props) {
      return props.showAdditionalOptions === 'OFF' || props.showDescription !== 'ìˆìŒ';
    },
  },
  showTopButton: {
    title: 'ìœ„ìª½ ë²„íŠ¼ ì˜µì…˜',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: showTopButtonLabels as any,
    defaultValue: 'ì—†ìŒ',
    hidden(props) {
      return props.showAdditionalOptions === 'OFF';
    },
  },
  topButtonText: {
    title: 'â†³ í…ìŠ¤íŠ¸',
    type: ControlType.String,
    defaultValue: 'ë²„íŠ¼ë ˆì´ë¸”',
    hidden(props) {
      return props.showAdditionalOptions === 'OFF' || props.showTopButton !== 'ìˆìŒ';
    },
  },
  onButtonClick: {
    type: ControlType.EventHandler,
  },
  onRightButtonClick: {
    type: ControlType.EventHandler,
  },
  onLeftButtonClick: {
    type: ControlType.EventHandler,
  },
  onTopButtonClick: {
    type: ControlType.EventHandler,
  },
});

(FixedBottomCTA as any).defaultProps = {
  width: 375,
  height: 110,
};

FixedBottomCTA.displayName = makeComponentDisplayName('FixedBottomCTA', 'í•˜ë‹¨CTA');
