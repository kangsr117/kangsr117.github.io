import { action } from '@storybook/addon-actions';
import { storiesOf } from '@storybook/react';
import _ from 'lodash';
import * as React from 'react';

import { Agreement, FixedBottomCTA } from 'src/react';

import Readme from '../README.md';

storiesOf('Agreement', module)
  .addParameters({ readme: { sidebar: Readme } })
  .add('ğŸ““example - 01 + 02 + 04', () => {
    function AgreementRow01And02And04Example() {
      const [[mustCheckedList, optionalCheckedList], setChecked] = React.useState([
        _.times(4, () => false),
        _.times(4, () => false),
      ]);

      function onChangeAllChecked(event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        setChecked([_.times(4, () => checked), _.times(4, () => checked)]);
        action('onChange - Agreement01 - ì•½ê´€ì— ëª¨ë‘ ë™ì˜')(event);
      }

      function onChangeMustCheckedAll(event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        setChecked([_.times(4, () => checked), optionalCheckedList]);
        action('onChange - Agreement02 - í† ìŠ¤ í•„ìˆ˜ í•­ëª© ëª¨ë‘ ë™ì˜')(event);
      }

      function onChangeOptionalAll(event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        setChecked([mustCheckedList, _.times(4, () => checked)]);
        action('onChange - Agreement02 - í† ìŠ¤ ì„ íƒ í•­ëª© ëª¨ë‘ ë™ì˜')(event);
      }

      function onChangeMustChecked(index: number, event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        const nextMustCheckedList = mustCheckedList.slice();
        nextMustCheckedList.splice(index, 1, checked);
        setChecked([nextMustCheckedList, optionalCheckedList]);
        action(`onChange - Agreement03 í•„ìˆ˜ í•­ëª© ${index + 1} ë™ì˜`)(event);
      }

      function onChangeOptionalChecked(index: number, event: React.ChangeEvent<HTMLInputElement>) {
        const { checked } = event.target;
        const nextOptionalCheckedList = optionalCheckedList.slice();
        nextOptionalCheckedList.splice(index, 1, checked);
        setChecked([mustCheckedList, nextOptionalCheckedList]);
        action(`onChange - Agreement03 ì„ íƒ í•­ëª© ${index + 1} ë™ì˜`)(event);
      }

      function onClickStartButton() {
        if (_.every(mustCheckedList)) {
          alert(`ì„±ê³µ!`);
        } else {
          alert('í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
        }
      }

      return (
        <>
          <Agreement.Section>
            <Agreement.Row01
              checked={_.every(mustCheckedList) && _.every(optionalCheckedList)}
              onChange={onChangeAllChecked}
              right={<Agreement.RightArrow onClick={action('onClick - ArrowRow01 label')} />}
            >
              ì•½ê´€ì— ëª¨ë‘ ë™ì˜
            </Agreement.Row01>

            <Agreement.List>
              <Agreement.Row02 checked={_.every(mustCheckedList)} onChange={onChangeMustCheckedAll}>
                í† ìŠ¤ í•„ìˆ˜ í•­ëª© ëª¨ë‘ ë™ì˜
              </Agreement.Row02>
              {mustCheckedList.map((checked, index) => (
                <Agreement.Row04
                  checked={checked}
                  onChange={_.partial(onChangeMustChecked, index)}
                  onLabelClick={action(
                    `onLabelClick - AgreementRow04 - í•„ìˆ˜ í•­ëª© ${index + 1} ë™ì˜`
                  )}
                  key={`agreement04-01-${index}`}
                >
                  í•„ìˆ˜ í•­ëª© {index + 1} ë™ì˜
                </Agreement.Row04>
              ))}
            </Agreement.List>

            <Agreement.List>
              <Agreement.Row02
                checked={_.every(optionalCheckedList)}
                onChange={onChangeOptionalAll}
              >
                í† ìŠ¤ ì„ íƒ í•­ëª© ëª¨ë‘ ë™ì˜
              </Agreement.Row02>
              {optionalCheckedList.map((checked, index) => (
                <Agreement.Row04
                  checked={checked}
                  onChange={_.partial(onChangeOptionalChecked, index)}
                  onLabelClick={action(
                    `onLabelClick - AgreementRow04 - ì„ íƒ í•­ëª© ${index + 1} ë™ì˜`
                  )}
                  key={`agreement04-02-${index}`}
                >
                  ì„ íƒ í•­ëª© {index + 1} ë™ì˜
                </Agreement.Row04>
              ))}
            </Agreement.List>
          </Agreement.Section>
          <FixedBottomCTA onClick={onClickStartButton}>ì‹œì‘</FixedBottomCTA>
        </>
      );
    }

    return <AgreementRow01And02And04Example />;
  });
