import { isBrowser } from "../utils/isBrowser";

let safeAreaExists: boolean | null = null;

export default function isSafeAreaExists(): boolean {
  if (!isBrowser()) {
    return false;
  }

  if (safeAreaExists !== null) {
    return safeAreaExists;
  }

  // Android Pie부터 safeArea가 iOS와 다르게 동작하는 문제가 있어서 이를 수정하는 Fix 입니다.
  // 아래의 링크를 참고했습니다.
  // @see https://stackoverflow.com/questions/52476016/envsafe-area-inset-top-not-working-on-android-pie-webview-69
  const insetChecker = document.createElement("div");
  insetChecker.style.position = "absolute";
  insetChecker.style.left = "-9999px";
  insetChecker.style.right = "-9999px";
  insetChecker.style.overflow = "hidden";
  insetChecker.style.height = "max(20px, env(safe-area-inset-bottom))";

  document.body?.appendChild?.(insetChecker);

  safeAreaExists = insetChecker.clientHeight !== 0;

  insetChecker?.parentNode?.removeChild?.(insetChecker);

  return safeAreaExists;
}
