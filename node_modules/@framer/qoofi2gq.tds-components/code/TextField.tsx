import { addPropertyControls, ControlType, PropertyControls } from 'framer';
import * as React from 'react';
import { default as TDSForm } from '../@tossteam/tds-web/react/components/Form/Form';
import {
  default as TDSTextField,
  Props as TDSTextFieldProps,
} from '../@tossteam/tds-web/react/components/TextField/TextField';
import { TDSComponent } from '../src/components/TDSComponent';
import { useFilteringEventHandlersInInspector } from '../src/hooks/useFilteringEventHandlersInInspector';
import '../src/styles/tds-framer.css';
import { isStaticRenderTarget } from '../src/utils/isStaticRenderTarget';
import { makeComponentDisplayName } from '../src/utils/makeDisplayName';

const typeLabels = ['ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸', 'ğŸ˜€ ì´ë¦„', 'ğŸ’° ê¸ˆì•¡', 'ğŸ“± ì „í™”ë²ˆí˜¸', '0ï¸âƒ£ ìˆ«ì', 'âœ… ğŸš§ì…€ë ‰í„°'] as const;
const stateLabels = ['ì¼ë°˜', 'ğŸš§í™œì„±', 'ì—ëŸ¬', 'ë¹„í™œì„±'] as const;
const keyboardTypeLabels = ['í•œê¸€', 'ì˜ë¬¸', 'ìˆ«ì'] as const;
const withClearButtonLabels = ['ON', 'OFF'] as const;
const withPasswordPreviewButtonLabels = ['ON', 'OFF'] as const;
const autoFocusLabels = ['ON', 'OFF'] as const;

type TypeLabel = typeof typeLabels[number];
type StateLabel = typeof stateLabels[number];
type KeyboardTypeLabel = typeof keyboardTypeLabels[number];
type WithClearButtonLabel = typeof withClearButtonLabels[number];
type WithPasswordPreviewButtonLabel = typeof withPasswordPreviewButtonLabels[number];
type AutoFocusLabel = typeof autoFocusLabels[number];

const defaultValueByType: {
  [key in TypeLabel]: { key: string; label: string; placeholder: string };
} = {
  'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸': {
    key: 'plainText',
    label: 'ë ˆì´ë¸”',
    placeholder: 'í”Œë ˆì´ìŠ¤í™€ë”',
  },
  'ğŸ˜€ ì´ë¦„': {
    key: 'name',
    label: 'ì´ë¦„ ì…ë ¥',
    placeholder: 'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”',
  },
  'ğŸ’° ê¸ˆì•¡': {
    key: 'price',
    label: 'ê¸ˆì•¡ ì…ë ¥',
    placeholder: 'ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”',
  },
  'ğŸ“± ì „í™”ë²ˆí˜¸': {
    key: 'phone',
    label: 'íœ´ëŒ€í°ë²ˆí˜¸',
    placeholder: 'ì „í™”ë²ˆí˜¸ ì…ë ¥',
  },
  '0ï¸âƒ£ ìˆ«ì': {
    key: 'number',
    label: 'ì œëª©',
    placeholder: 'ìˆ«ì ì…ë ¥',
  },
  'âœ… ğŸš§ì…€ë ‰í„°': {
    key: 'number',
    label: 'ì œëª©',
    placeholder: 'ìˆ«ì ì…ë ¥',
  },
};

const propertyControls = Object.entries(defaultValueByType).reduce<PropertyControls<Props, any>>(
  (acc, [type, defaultValue]) => ({
    ...acc,
    [`${defaultValue.key}Label`]: {
      title: 'ì œëª©',
      type: ControlType.String,
      defaultValue: defaultValue.label,
      hidden(props) {
        return props.type !== type;
      },
    },
    [`${defaultValue.key}Placeholder`]: {
      title: 'í”Œë ˆì´ìŠ¤í™€ë”',
      type: ControlType.String,
      defaultValue: defaultValue.placeholder,
      hidden(props) {
        return props.type !== type;
      },
    },
  }),
  {}
);

const propsByTypeControlLabel: {
  [key in TypeLabel]: TDSTextFieldProps;
} = {
  'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸': {},
  'ğŸ˜€ ì´ë¦„': { type: 'name' },
  'ğŸ’° ê¸ˆì•¡': { type: 'tel' },
  'ğŸ“± ì „í™”ë²ˆí˜¸': { type: 'tel' },
  '0ï¸âƒ£ ìˆ«ì': { type: 'tel' },
  'âœ… ğŸš§ì…€ë ‰í„°': { type: 'tel' },
};

const autoFocusByControlLabel: {
  [key in AutoFocusLabel]: TDSTextFieldProps['autoFocus'];
} = {
  ON: true,
  OFF: false,
};

interface Props {
  type: TypeLabel;
  inputValue: string;
  helpText: string;
  suffix: string;
  state: StateLabel;
  keyboardType: KeyboardTypeLabel;
  withClearButton: WithClearButtonLabel;
  withPasswordPreviewButton: WithPasswordPreviewButtonLabel;
  autoFocus: AutoFocusLabel;

  onFocus: () => void;
  onChange: () => void;
  onSubmit: () => void;
}

export function TextField(props: Props) {
  const {
    type,
    inputValue,
    helpText,
    suffix,
    state,
    keyboardType,
    withClearButton,
    withPasswordPreviewButton,
    autoFocus,

    onFocus,
    onChange,
    onSubmit,
    ...rest
  } = useFilteringEventHandlersInInspector(props);

  const [value, setValue] = React.useState(inputValue);

  React.useEffect(() => {
    setValue(inputValue);
  }, [inputValue]);

  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    setValue(event.target.value);
    onChange?.();
  };

  return (
    <TDSForm>
      <TDSForm.Group label={rest[`${defaultValueByType[type].key}Label`]} help={helpText} hasError={state === 'ì—ëŸ¬'}>
        <TDSComponent
          name="TextField"
          summary={{
            value: value ? value : undefined,
            placeholder: rest[`${defaultValueByType[type].key}Placeholder`],
            suffix: type === 'ğŸ’° ê¸ˆì•¡' ? suffix : undefined,
            autoFocus: autoFocusByControlLabel[autoFocus],
            error: state === 'ì—ëŸ¬',
            disabled: state === 'ë¹„í™œì„±',
            label: rest[`${defaultValueByType[type].key}Label`]
              ? rest[`${defaultValueByType[type].key}Label`]
              : undefined,
            helpText: helpText ? helpText : undefined,
          }}
        >
          <TDSTextField
            {...propsByTypeControlLabel[type]}
            value={value}
            placeholder={rest[`${defaultValueByType[type].key}Placeholder`]}
            suffix={type === 'ğŸ’° ê¸ˆì•¡' ? suffix : undefined}
            autoFocus={isStaticRenderTarget() ? false : autoFocusByControlLabel[autoFocus]}
            disabled={state === 'ë¹„í™œì„±'}
            onChange={handleChange}
            onFocus={onFocus}
            onKeyPress={e => {
              if (e.which === 13) {
                onSubmit();
              }
            }}
          />
        </TDSComponent>
      </TDSForm.Group>
    </TDSForm>
  );
}

addPropertyControls(TextField, {
  type: {
    title: 'ì¢…ë¥˜',
    type: ControlType.Enum,
    options: typeLabels as any,
    defaultValue: 'ğŸ“„ ì¼ë°˜ í…ìŠ¤íŠ¸',
  },
  ...propertyControls,
  inputValue: {
    title: 'ì…ë ¥ê°’',
    type: ControlType.String,
    defaultValue: '',
  },
  helpText: {
    title: 'ë„ì›€ë§',
    type: ControlType.String,
    defaultValue: '',
  },
  suffix: {
    title: 'ì› í‘œì‹œ',
    type: ControlType.String,
    defaultValue: 'ì›',
    hidden(props) {
      return props.type !== 'ğŸ’° ê¸ˆì•¡';
    },
  },
  state: {
    title: 'ìƒíƒœ',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: stateLabels as any,
    defaultValue: 'ì¼ë°˜',
  },
  withClearButton: {
    title: 'ğŸš§ì§€ìš°ê¸°ë²„íŠ¼',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: withClearButtonLabels as any,
    defaultValue: 'ON',
    hidden(props) {
      return [
        'ğŸ’° ê¸ˆì•¡',
        'ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬',
        'ğŸ‘¤ ì£¼ë¯¼ë²ˆí˜¸ ë’¤ 7ìë¦¬',
        'ğŸ“± ì „í™”ë²ˆí˜¸',
        'ğŸ” ë¹„ë°€ë²ˆí˜¸',
        '0ï¸âƒ£ ìˆ«ì',
      ].includes(props.type);
    },
  },
  autoFocus: {
    title: 'ìë™ í¬ì»¤ìŠ¤',
    type: ControlType.Enum,
    displaySegmentedControl: true,
    options: autoFocusLabels as any,
    defaultValue: 'OFF',
  },

  onFocus: {
    type: ControlType.EventHandler,
  },
  onChange: {
    type: ControlType.EventHandler,
  },
  onSubmit: {
    type: ControlType.EventHandler,
  },
});

(TextField as any).defaultProps = {
  width: 375,
  height: 74,
};

TextField.displayName = makeComponentDisplayName('TextFieldClassic', 'í…ìŠ¤íŠ¸í•„ë“œí´ë˜ì‹');
