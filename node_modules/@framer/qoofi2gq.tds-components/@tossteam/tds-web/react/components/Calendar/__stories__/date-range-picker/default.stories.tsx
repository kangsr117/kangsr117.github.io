import { action } from "@storybook/addon-actions";
import { boolean, number } from "@storybook/addon-knobs";
import { storiesOf } from "@storybook/react";
import { addDays, format } from "date-fns";
import * as React from "react";
import { createElement, useCallback, useState } from "react";
import DateRangePicker from "../../DateRangePicker";

storiesOf("Calendar.Date Range Picker (DRP)", module).add("default", () =>
  createElement(() => {
    const [maxDate, setMaxDate] = useState<Date | undefined>(undefined);
    const maxDayCount = number("최대 선택 가능 일수", 90);
    const applyMaxDate = useCallback(
      ([startDate, endDate]) => {
        action("onDateChanges")(
          startDate ? format(startDate, "yyyy-MM-dd") : startDate,
          endDate ? format(endDate, "yyyy-MM-dd") : endDate
        );
        if (startDate !== undefined) {
          setMaxDate(addDays(startDate, maxDayCount));
        }
      },
      [maxDayCount]
    );

    const allowSameDateSelect = boolean("allowSameDateSelect", false);

    return (
      <DateRangePicker
        maxSelectableDate={maxDate}
        onDatesChange={applyMaxDate}
        allowSameDateSelect={allowSameDateSelect}
      />
    );
  })
);
